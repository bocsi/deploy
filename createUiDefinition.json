{
	"$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
	"handler": "Microsoft.Azure.CreateUIDef",
	"version": "0.1.2-preview",
	"parameters": {
		"config": {
			"isWizard": false,
			"basics": {
				"description": ">Resource group name ***MUST*** start with *rg-app*.If you want to follow the naming convention used by the deployment, the last part of the name should be the location where the landing zone will be deployed. Example: *rg-app-eastus* - if the 'East US' region was chosen.",
				"resourceGroup": {
					"constraints": {
						"validations": [
							{
								"isValid": "[startsWith(resourceGroup().name, 'rg-app')]",
								"message": "Resource group name must start with 'rg-app'. If you want to follow the naming convention used by the deployment, the last part of the name should be the location where the landing zone will be deployed. Example: 'rg-app-eastus' - if the 'East US' region was chosen."
							}
						]
					},
					"allowExisting": false
				}
			}
		},
		"basics": [],
		"steps": [
			{
				"name": "gatewaySettings",
				"label": "Gateway Settings",
				"elements": [
					{
						"name": "deploy_gateway",
						"type": "Microsoft.Common.DropDown",
						"label": "Deploy Virtual Network Gateway (Optional)",
						"defaultValue": "No",
						"toolTip": "If you require hybrid connectivity select yes. If unsure contact support@biggreenit.com.",
						"constraints": {
							"required": true,
							"allowedValues": [
								{
									"label": "Yes",
									"value": "true"
								},
								{
									"label": "No",
									"value": "false"
								}
							]
						},
						"visible": true
					}
				]
			},
			{
				"name": "requirments",
				"label": "Prerequisites Validation",
				"elements": [
					{
						"name": "roleAssignments",
						"type": "Microsoft.Solutions.ArmApiControl",
						"request": {
							"method": "GET",
							"path": "[concat(subscription().id, '/providers/Microsoft.Authorization/roleAssignments?api-version=2022-04-01')]"
						}
					},
					{
						"name": "validationPass",
						"type": "Microsoft.Common.InfoBox",
						"visible": "[contains(map(steps('requirments').roleAssignments.value, (item) => item.properties.principalId), '1be25b90-dc61-4f76-8231-aef1acfbefb5')]",
						"options": {
							"icon": "Info",
							"text": "Prerequisites for this deployment are met",
							"uri": "https://www.microsoft.com"
						}
					},
					{
						"name": "validationFail",
						"type": "Microsoft.Common.InfoBox",
						"visible": "[not(contains(map(steps('requirments').roleAssignments.value, (item) => item.properties.principalId), '1be25b90-dc61-4f76-8231-aef1acfbefb5'))]",
						"options": {
							"icon": "Error",
							"text": "Prerequisites for this deployment were NOT met. Deployment WILL fail. You will need to assign 'Contributor' permission on the subscription level for 'Managed Applications On Behalf Application'. Follow the link to the readme for instructions to fix this.",
							"uri": "https://www.microsoft.com"
						}
					}
				]
			}
		],
		"outputs": {
			"location": "[location()]",
			"deploy_gateway": "[bool(steps('gatewaySettings').deploy_gateway)]"
		}
	}
}